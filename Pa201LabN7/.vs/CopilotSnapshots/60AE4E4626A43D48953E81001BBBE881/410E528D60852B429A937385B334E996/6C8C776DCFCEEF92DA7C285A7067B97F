using Pa201LabN7.Services;
using Pa201LabN7.Models;
using System;
using System.Linq;

Console.WriteLine("Testing EventService...");

var eventService = new EventService();

// Use a local async scope
await TestEventServiceAsync(eventService);

async Task TestEventServiceAsync(EventService service)
{
    // Create
    Console.WriteLine("Creating event...");
    await service.CreateEventAsync("Test Event", DateTime.Now.AddDays(1), 9.99m);

    // Read all
    var all = await service.GetAllEventsAsync();
    Console.WriteLine($"Events after create ({all.Count}):");
    foreach (var ev in all)
    {
        Console.WriteLine(ev);
    }

    var first = all.FirstOrDefault();
    if (first is not null)
    {
        // Read single
        var single = await service.GetEventAsync(first.Id);
        Console.WriteLine("Read single event:");
        Console.WriteLine(single);

        // Update
        Console.WriteLine("Updating event...");
        await service.UpdateEventAsync(first.Id, first.Name + " Updated", first.Date.AddDays(2), first.Price + 5);
        var updated = await service.GetEventAsync(first.Id);
        Console.WriteLine("Updated event:");
        Console.WriteLine(updated);

        // Delete
        Console.WriteLine("Deleting event...");
        var deleted = await service.DeleteEventAsync(first.Id);
        Console.WriteLine($"Delete result: {deleted}");
    }

    // Final list
    var final = await service.GetAllEventsAsync();
    Console.WriteLine($"Events at end ({final.Count}):");
    foreach (var ev in final)
    {
        Console.WriteLine(ev);
    }

    Console.WriteLine("Test completed.");
}

